
# Linux系统中多网卡优先级配置

## 前言

在一台Linux服务器中，可能同时有多块网卡，一块用于连接内网，一块用于连接外网。或者一个是有线网络、另一个是无线网络等场景。

此时，我们需要对网卡的优先级进行有效的配置，否则可能会导致网络异常，无法正常访问的一系列问题。

## 什么是网卡路由优先级

网卡路由优先级只是在路由表里的多个路由中选择与转发包中的目标地址最为匹配的路由时的顺序。

其中，每个路由都会设置一个跃点数，跃点越低则表示优先级越高。

通常，跃点可以根据网络速度、可靠性、吞吐量、管理属性等进行指定。

查询路由信息的方式如下：

```bash
route -n

# 内核 IP 路由表
# 目标             网关             子网掩码         标志   跃点   引用      使用 接口
# 0.0.0.0         192.168.1.1     0.0.0.0         UG    20100  0        0   enp0s31f6
# 169.254.0.0     0.0.0.0         255.255.0.0     U     1000   0        0   enp0s31f6
# 172.17.0.0      0.0.0.0         255.255.0.0     U     0      0        0   docker0
# 172.18.0.0      0.0.0.0         255.255.0.0     U     0      0        0   docker_gwbridge
# 192.168.1.0     0.0.0.0         255.255.255.0   U     100    0        0   enp0s31f6
```

此时，需要注意的是，如果有两块网卡的跃点值相同，泽辉出现抢占优先级，从而导致的网卡冲突，可能导致一块网卡无法连接。


## 如何修改网卡优先级

那么，怎么修改网卡的优先级呢？

修改网卡优先级的方式就是修改网卡的配置文件，并添加或修改其中的`IPV4_ROUTE_METRIC`参数。

网卡的配置文件所在的目录为`/etc/sysconfig/network-script/`。

通常，配置文件的名称为`ifcfg-xxx`。其中，xxx表示网卡名称或无线Wifi名称。

配置文件格式如下：

```
NAME=“eth1”
TYPE=“Ethernet”
BOOTPROTO=“none”
DEVICE=“eth1”
ONBOOT=“yes”
IPADDR=****
NETMASK=255.255.255.224
GATEWAY=****
IPV4_ROUTE_METRIC=100
```

其中，上述最后一行的`IPV4_ROUTE_METRIC`就是用于设置网卡跃点数的配置，如果之前没有改行，可以主动添加并设置。

修改完配置文件后需要重启网络服务才能生效:

```bash
systemctl restart network
```

服务重启完成后，可以`route -n`命令查询配置的跃点数是否生效。
